'use strict';

var _require = require('fs'),
    readdirSync = _require.readdirSync;

var _require2 = require('path'),
    basename = _require2.basename,
    join = _require2.join;

var _require3 = require('is-directory'),
    isDir = _require3.sync;

var isPng = function isPng(fp) {
	return !!/\.png$/i.test(fp);
};

var isSpriteDir = function isSpriteDir(dir) {
	return function (fp) {
		return isDir(join(dir, fp));
	};
};

var hasPngInSpriteDir = function hasPngInSpriteDir(dir) {
	return function (fp) {
		var file = join(dir, fp);

		return !isDir(file) && isPng(file);
	};
};

var hasIconsInSpriteDir = function hasIconsInSpriteDir(dir, spritesPath) {
	return function (fp) {
		var folder = join(dir, fp);

		if (!isDir(folder)) {
			return false;
		}

		var files = readdirSync(folder);

		if (!files.length) {
			console.warn('[sprites] Put icons to \'' + spritesPath + '/' + basename(folder) + '\' or delete this folder.');

			return false;
		}

		return !!files.filter(hasPngInSpriteDir(folder)).length;
	};
};

module.exports = function () {
	var cwd = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : process.cwd();
	var spritesPath = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'app/sprites';

	var dir = join(cwd, spritesPath);
	var hasSpritesDir = isDir(dir);

	if (!hasSpritesDir) {
		return false;
	}

	var spritesDirFiles = readdirSync(dir);
	var hasIconsInSpritesDir = !!spritesDirFiles.filter(isPng).length;

	if (hasIconsInSpritesDir) {
		console.warn('[sprites] Move icons from \'' + spritesPath + '\' to \'' + spritesPath + '/<name>\' or delete them.');

		return false;
	}

	var hasIconsInSpriteDirs = !!spritesDirFiles.filter(hasIconsInSpriteDir(dir, spritesPath)).length;

	if (!hasIconsInSpriteDirs) {
		return false;
	}

	return true;
};